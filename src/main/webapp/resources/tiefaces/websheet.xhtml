<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core"	
	xmlns:p="http://primefaces.org/ui">

<!-- INTERFACE -->
<cc:interface componentType="tieWebSheetComponent">

	<cc:attribute name="webSheetBean" required="true"
		type="com.tiefaces.components.websheet.TieWebSheetBean" />
	<cc:attribute name="rendered" required="false" default="true"
		type="java.lang.Boolean" />
	<cc:attribute name="readonly" required="false" default="false"
		type="java.lang.Boolean" />
	<cc:attribute name="showLineNumber" required="false" default="true"
		type="java.lang.Boolean" />
	<cc:attribute name="paginator" required="false" default="#{cc.attrs.webSheetBean.multiplePage}"
		type="java.lang.Boolean" />
	<cc:attribute name="paginatorTemplate" required="false" default="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
		type="java.lang.String" />
	<cc:attribute name="paginatorPosition" required="false"
		default="bottom" type="java.lang.String" />
	<cc:attribute name="paginatorAlwaysVisible" required="false"
		default="false" type="java.lang.Boolean" />
	<cc:attribute name="maxRowsPerPage" required="false" default="#{cc.attrs.webSheetBean.maxRowsPerPage}"
		type="java.lang.String" />
	<cc:attribute name="rowsPerPageTemplate" required="false" default="#{cc.attrs.webSheetBean.maxRowsPerPage} #{cc.attrs.webSheetBean.maxRowsPerPage * 2}"
		type="java.lang.String" />
	<cc:attribute name="tableWidthStyle" required="false" default="#{cc.attrs.webSheetBean.tableWidthStyle}"
		type="java.lang.String" />

</cc:interface>

<!-- IMPLEMENTATION -->
<cc:implementation>
	<h:outputStylesheet name="tiefaces/websheet.css" />
	<div id="#{cc.clientId}">
	
		 <p:tabView scrollable="true" style="height: 35px;" binding="#{cc.attrs.webSheetBean.webFormTabView}" rendered="#{cc.attrs.rendered}">
			<p:ajax event="tabChange" listener="#{cc.attrs.webSheetBean.onTabChange}" update="@form"  /> 
		     <c:forEach items="#{cc.attrs.webSheetBean.tabs}" var="tab" varStatus="status" >
		         <p:tab  title="#{tab.title}" rendered="#{cc.attrs.rendered}" />
		     </c:forEach>
		 </p:tabView>
	  	

		<div id="websheet">
			<p:dataTable var="dataRow"
			    binding="#{tiewebsheettable}"
				rendered="#{cc.attrs.rendered}"
				value="#{cc.attrs.webSheetBean.bodyRows}"
				paginator="#{cc.attrs.paginator}" 
				paginatorPosition="#{cc.attrs.paginatorPosition}"
				rows="#{cc.attrs.webSheetBean.maxRowsPerPage}"
				paginatorAlwaysVisible="cc.attrs.paginatorAlwaysVisible"
				paginatorTemplate="#{cc.attrs.paginatorTemplate}"
				rowsPerPageTemplate="#{cc.attrs.rowsPerPageTemplate}"
				rowIndexVar="rowindex" widgetVar="webSheetTable"
				tableStyle="table-layout: fixed; width:#{cc.attrs.tableWidthStyle} ">


				<p:columnGroup type="header">
					<c:forEach items="#{cc.attrs.webSheetBean.headerRows}"
						var="headerrow" varStatus="loopheaderrow">
						<p:row>
							<p:column width="18" rendered="#{cc.attrs.showLineNumber}" />
							<c:forEach items="#{headerrow}" var="headerrowcolumn"
								varStatus="loopheaderrowcolumn">
								<p:column rowspan="#{headerrowcolumn.rowspan}"
									colspan="#{headerrowcolumn.colspan}"
									headerText="#{headerrowcolumn.headertext}"
									style="#{headerrowcolumn.style}" />
							</c:forEach>
						</p:row>
					</c:forEach>
				</p:columnGroup>

				<p:column width="18" style="text-align: center;" rendered="#{cc.attrs.showLineNumber and dataRow[0].rendered}">
					<h:outputText value="#{dataRow[0].rowIndex + 1}" />
				</p:column>

				<c:forEach items="#{cc.attrs.webSheetBean.columns}" var="column"
					varStatus="loop">
					<p:column rendered="#{not empty dataRow[loop.index +1] and dataRow[0].rendered }"
						rowspan="#{dataRow[loop.index +1].rowspan}"
						colspan="#{dataRow[loop.index +1].colspan}"
						style="#{dataRow[loop.index +1].style}">
						<h:outputText id="cocalc#{loop.index}"
							rendered="#{empty dataRow[loop.index +1].inputType}"
							style="#{dataRow[loop.index +1].style}"
							styleClass="inputColumnWidth"
							value="#{dataRow[loop.index +1].cellValue}" />
						<p:inputText id="column#{loop.index}"
							value="#{dataRow[loop.index +1].cellValue}"
							style="#{dataRow[loop.index +1].validStyle}"
							styleClass="inputColumnWidth"
							readonly="#{cc.attrs.readonly}" autocomplete="off"
							rendered="#{(!empty dataRow[loop.index +1].inputType) and ( dataRow[loop.index +1].inputType != 'textarea' ) }"
							onkeypress="if (event.keyCode == 13) { onchange(); return false; }">

							<p:ajax event="change" process="@this"
								listener="#{cc.attrs.webSheetBean.valueChangeEvent}" />

						</p:inputText>
						<p:inputTextarea id="coarea#{loop.index}" rows="3"
							value="#{dataRow[loop.index +1].cellValue}"
							style="#{dataRow[loop.index +1].style}"
							styleClass="inputTextarea inputColumnWidth"
							readonly="#{cc.attrs.readonly}" autocomplete="off"
							rendered="#{dataRow[loop.index +1].inputType == 'textarea'}">

							<p:ajax event="change" process="@this"
								listener="#{cc.attrs.webSheetBean.valueChangeEvent}" />
						</p:inputTextarea>
						<h:outputText id="msgcolumn#{loop.index}" style="color:red"
							styleClass="inputColumnWidth"
							value="#{dataRow[loop.index +1].errormsg}" />
					</p:column>
				</c:forEach>


			</p:dataTable>


		</div>



	</div>
</cc:implementation>
</html>